(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const L=document.getElementById("imageUpload"),r=document.getElementById("upload-container"),B=document.getElementById("upload-label"),w=document.getElementById("upload-text"),l=document.getElementById("imagePreview"),u=document.getElementById("loader"),v=document.getElementById("progress-bar"),E=document.getElementById("result-container"),I=document.getElementById("resultImage"),x=document.getElementById("estimatedAge"),f=document.getElementById("downloadBtn"),h=document.getElementById("shareBtn"),F=document.getElementById("retryBtn");let c=null;async function A(){console.log("AI 모델 로딩 시작...");const t="./models";try{await Promise.all([faceapi.nets.ssdMobilenetv1.loadFromUri(t),faceapi.nets.ageGenderNet.loadFromUri(t)]),console.log("AI 모델 로딩 완료!"),w.textContent="사진을 드래그, 붙여넣기, 클릭하여 업로드하세요."}catch(e){console.error("모델 로딩에 실패했습니다:",e),w.textContent="모델 로딩 실패! 새로고침 해주세요.",alert("AI 모델을 불러오는 데 문제가 발생했습니다. 페이지를 새로고침 해보세요.")}}async function C(){y(),U(),console.log("얼굴 분석을 시작합니다...");const t=await faceapi.detectSingleFace(l).withAgeAndGender();R(),t?(console.log("분석 결과:",t),c=Math.round(t.age),I.src=l.src,x.textContent=c,r.classList.add("hidden"),E.classList.remove("hidden"),f.disabled=!1,h.disabled=!1,T()):(console.log("얼굴을 찾지 못했습니다."),alert("얼굴을 인식할 수 없습니다. 더 선명한 정면 사진으로 다시 시도해주세요."),b())}function p(t){if(!t||!t.type.startsWith("image/")){alert("이미지 파일만 업로드할 수 있습니다.");return}y();const e=new FileReader;e.onload=n=>{l.src=n.target.result,l.onload=()=>C()},e.readAsDataURL(t)}function b(){E.classList.add("hidden"),u.classList.add("hidden"),r.classList.remove("hidden"),r.style.backgroundImage="",B.classList.remove("hidden");const t=document.getElementById("meme-card-preview");t.innerHTML='<p class="text-gray-400 text-sm p-4 text-center">결과가 여기에 표시됩니다</p>',y()}function y(){I.src="#",c=null,f.disabled=!0,h.disabled=!0}function U(){r.classList.add("hidden"),u.classList.remove("hidden"),v.style.width="0%",setTimeout(()=>{v.style.width="100%"},100)}function R(){setTimeout(()=>{u.classList.add("hidden")},500)}async function T(){const t=document.getElementById("meme-card-preview");t.innerHTML="";const e=document.createElement("canvas");e.width=800,e.height=1e3;const n=e.getContext("2d");n.fillStyle="#FFFFFF",n.fillRect(0,0,e.width,e.height);const s=document.getElementById("imagePreview"),o=s.naturalWidth/s.naturalHeight,a=e.width/(e.height-180);let d,i,m,g;o>a?(i=e.height-180,d=i*o,m=(e.width-d)/2,g=90):(d=e.width,i=d/o,m=0,g=(e.height-180-i)/2+90),n.drawImage(s,m,g,d,i),n.fillStyle="#4f46e5",n.fillRect(0,0,e.width,180),n.fillStyle="white",n.textAlign="center",n.font="bold 80px sans-serif",n.fillText(`AI 분석결과 ${c}세`,e.width/2,115),n.fillStyle="#9ca3af",n.font="30px sans-serif",n.fillText("aiface.pages.dev",e.width/2,e.height-50),e.style.width="100%",e.style.height="100%",e.style.objectFit="contain",t.appendChild(e)}function M(){const t=document.querySelector("#meme-card-preview canvas");if(!t){alert("다운로드할 이미지가 없습니다.");return}const e=document.createElement("a");e.download="aiface-test-result.png",e.href=t.toDataURL("image/png"),e.click()}window.addEventListener("load",A);r.addEventListener("click",()=>L.click());L.addEventListener("change",t=>p(t.target.files[0]));r.addEventListener("dragover",t=>{t.preventDefault(),r.classList.add("border-orange-500","bg-orange-50")});r.addEventListener("dragleave",()=>{r.classList.remove("border-orange-500","bg-orange-50")});r.addEventListener("drop",t=>{t.preventDefault(),r.classList.remove("border-orange-500","bg-orange-50"),p(t.dataTransfer.files[0])});window.addEventListener("paste",t=>{const e=t.clipboardData.items;for(const n of e)if(n.type.indexOf("image")!==-1){const s=n.getAsFile();p(s);break}});f.addEventListener("click",M);h.addEventListener("click",()=>{navigator.clipboard.writeText(window.location.href).then(()=>{alert("링크가 복사되었어요! 친구에게 공유해보세요.")}).catch(t=>{console.error("링크 복사 실패:",t),alert("링크 복사에 실패했어요.")})});F.addEventListener("click",b);
